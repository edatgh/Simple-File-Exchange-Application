
                           --------- SFSA: Simple File Sharing Application ---------

                                                 Java-Java

                                                Edvardas Ges

                                                 2004/03/05


1. Idìja
--------

Po ilgù svarstymù, nusprend¾iau para¹yti programa, realizuojanèia filù apsikeitim± tarp keliù klientù.
Mano pasirinkimas pagrçstas reikalaujamu parodyti "client/server" bendravim±. Manau sç program± bus
puikus keliù klientù bei serverio bendravimo pavizdys.

2. Programos struktþra
----------------------

Programa susideda i¹ dviejù daliù, t.y. i¹ klientinìs dalies (client) ir serverinìs dalies (server).
Paleid¾iant klientinê programos dalç, vartotojui parodoma konsolì, kurioje jis gali çvedinìti koman-
das ir tokiu budu bendrauti su programos serveriu. Prisijungias prie serverio, klientas gali nusius-
ti jam failù s±ra¹±, kuriuos jis nori eksportuoti, bei parsisiusti failù s±ra¹±, kuriuos eksportuoja
kiti klientai. Kitaip tariant, kiekvienas klientas nusiunèia serveriui s±ra¹± eksportuojamù failu.
Tokiu budu serveryje laikomas bendras visù klientù eksportuojamù failù s±ra¹as. Kiekvienas klientas
gali u¾sisakyti norim± fail±. Kai çvyksta toks u¾sakymas, serverio pagalba nustatomas ry¹is tarp dviejù
klientù, t.y. kliento-u¾sakovo ir kliento-tiekìjo (tas klientas kuris turi reikiam± fail±). Toliau
vyksta bendravimas tik tarp tù dviejù klientù, o serveris gali toliau têsti kitù klientù u¾klausù ap-
tarnavim±.

3. Kliento/serverio ypatumai
----------------------------

Tam tikrù smulkmenù s±ra¹iukas.

3.1. Kliento ypatumai
---------------------

  o Eksportuojamù failù s±ra¹as nuskaitomas i¹ failo, kurio pavadinimas nurodytas komandinìje eilutìje.
    ©ito failo struktþra yra labai paprasta, kiekvienoje eiluteje yra pilnas failo pavadinimas. Tokiù
    eiluèiù bus lygiai tiek, kiek yra eksportuojamù failù.

  o Duomenys reikalingi prisijungti prie serverio, nurodomi komandinìje eilutìje. ©itie duomenys nìra
    privalomi, jie reikalingi kliento "elgesio" pagal nutylìjim± pakeitimui.

  o Jeigu vartotojas neçves programos parametrù, bus naudojami parametrai pagal nutylìjim±: tam tikras
    serverio porto numeris ir "loopback" IPv4 adresas (127.0.0.1), failai nebus eksportuojami.

3.2. Serverio ypatumai
----------------------

  o Serveriui reikalingi parametrai nurodomi komendinìje eilutìje.

  o Jeigu serveriui reikalingi parametrai nebus nurodyti komandinìje eilutìje, bus naudojami parametrai
    pagal nutylìjim±.

4. Kliento/serverio realizacija
-------------------------------

Dìtalus veikimo principù apra¹ymas.

4.1. Failù perdavimo mechanizmo skirtumai nuo C-C realizacijos
--------------------------------------------------------------

Skirtingai nuo C-C realizacijos, dabar vartotojù s±ra¹as nìra saugomas serveryje. Kadangi serveris
paled¾ia atskir± gij± kiekvienam vartotojui, vartotojù s±ra¹o saugoti nera bþtina. Bet serveryje
yra saugomas visù vartotojù visù eksportuojamù failù s±ra¹as. To s±ra¹e elementai yra objektai kurie
saugo informacija apie kliento eksportuojanèio fail± failù serverç. ©ita informacija naudoma kai
kas nors (tam tikras klientas) bando u¾sisakyti fail±. Paie¹ka vykdoma visame s±ra¹e, kai surandamas
failas, serveris jungiasi prie FS kliento turinèio faila naudojant tuos duomenis, kuriuos surado
failù sara¹o objekte. Toliau viskas vyksta analogi¹kai C-C realizacijai.

4.2. Serverio vaidmuo
---------------------

Serveris yra labai svarbus, nors gali pasirodyti, jog jis beveik nedalyvauja failo perdavimo sesijoje.
I¹ tikrjùjù serveris sinchronizuoja klientù darb±. Kiekvieno kliento failù serveris ¾ino kaip perduoti
(ir priimti) fail± kitam (i¹ kito) klientui (kliento), bet jie (failù serveriai) nezino kaip susijungti
tarpusavyje, èia jiems padeda serveris. Kai pvz. 2 klientai "surado vienas kit±", serverio darbas nesi-
baigia, jis privalo parupinti t± patç ir kitiems klientams.


5. Programos schema
-------------------


        C.FS to A.FS connection and file transmission
  +-------------------------------------------------------+
  |                                                       |
  |                        getfile                        |
  |        +---------------------------------------+      |
  |        |                                      \|/     |
  |   +----------+       register user        +----------+|       register user
  |   | CLIENT A |<-------------------------->|  SERVER  |<------------------------------+
  |   |          |  connection acc./refuse    |          ||   connection acc./refuse     |
  |   |          |                         +->|          ||                              |
  |   +----------+                         |  +----------+|      +----------+ +----------+
  +-->|    FS    |                         |  | A: FILES ||   +--| CLIENT C |<+
      +----------+                         |  +----------+|   |  +----------+
                                           |  | B: FILES |+---+--|    FS    |<-----------+
      +----------+       register user     |  +----------+    |  +----------+            |
      | CLIENT B |<------------------------+  | C: FILES |<---+--{send export file names}|
      +----------+ connection acc./refuse     +----------+                               |
      |    FS    |                            |    ...   |                               |
      +----------+                            +----------+                               |
                                                   |           info about A              |
                                                   +-------------------------------------+

6. Problemos
------------

  o Problema arsirado kai reikìjo siusti failo duomenis kliento-u¾sakovo FS. A¹ sukuriu buferç tam tikro
    dyd¾io ir cikli¹kai nuskaitinìju fail± blokais, duomenys talpinu i buferç ir t± buferç tam tikru
    bþdu nusiunèiu kliento-u¾sakovo FS. Kai band¾iau padaryti to buferio dydç 1Kb, kliento-u¾sakovo FS
    gaudavo "nes±moningus" duomenis. Vìliau supratau, jog problema ne mano programoje. Problemos pavyko
    i¹vengti atsitiktinai. Paprasèiausiai pradejau kaitalioti buferio dydç ir sustojau ties to, kurç
    siusdavo "tvarkingai". Man nepavyko i¹siai¹kinti tos problemos prie¾asties, bet turiu prielaid±. Manau,
    jog FreeBSD+Java nevisai suderinta, t.y. tikrai zinau, kad egzistuoja daug klaidù, ¾inau jog tos
    klaidos taisomos, t.t. FreeBSD+Java dabartiniu metu yra "experimental software" - manau tai gali
    bþti mano problemos prie¾astimi.

7. Literatþra
-------------

UNIX man pages
FreeBSD Developers' Handbook
Java Development Kit 1.4 Documentation
